{
  "hash": "11464f2a6387cdcaf66b0eedf07f40d3",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Atividade 02 - Monitoramento de √înibus em Tempo Real\"\nauthor: \"Seu Nome\"\ndate: \"2024-11-23\"\ncategories: [python, api, mapas, geolocaliza√ß√£o]\nimage: \"thumbnail.jpg\"\n---\n\n## Objetivo\n\nCriar um sistema de monitoramento em tempo real de √¥nibus da SPTrans utilizando a API Olho Vivo, com visualiza√ß√£o em mapa interativo.\n\n## Tecnologias Utilizadas\n\n- **Python 3.x**\n- **requests**: Para autentica√ß√£o e requisi√ß√µes √† API\n- **folium**: Para criar mapas interativos\n- **API SPTrans Olho Vivo**: Dados de transporte p√∫blico de S√£o Paulo\n\n## Arquitetura da Solu√ß√£o\n\n### 1. Autentica√ß√£o\n\nA API SPTrans exige autentica√ß√£o via POST com um token:\n\n```python\ndef autenticar(self):\n    \"\"\"Autentica na API da SPTrans\"\"\"\n    url = f\"{self.base_url}/Login/Autenticar?token={self.token}\"\n    response = self.session.post(url)\n    if response.text == \"true\":\n        print(\"‚úì Autentica√ß√£o realizada com sucesso!\")\n```\n\n**Importante**: A sess√£o autenticada deve ser mantida para todas as requisi√ß√µes subsequentes.\n\n### 2. Classe MonitoramentoOnibus\n\nImplementei uma classe para encapsular todas as funcionalidades:\n\n```python\nclass MonitoramentoOnibus:\n    def __init__(self, token):\n        self.token = token\n        self.session = requests.Session()\n        self.base_url = \"http://api.olhovivo.sptrans.com.br/v2.1\"\n        self.autenticar()\n```\n\n### 3. Busca de Linhas\n\nPermite buscar linhas por termo de pesquisa:\n\n```python\ndef buscar_linhas(self, termo_busca):\n    \"\"\"Busca linhas de √¥nibus por termo\"\"\"\n    url = f\"{self.base_url}/Linha/Buscar?termosBusca={termo_busca}\"\n    response = self.session.get(url)\n    return response.json()\n```\n\n### 4. Obten√ß√£o de Dados em Tempo Real\n\nDuas fun√ß√µes principais coletam dados:\n\n#### Paradas da Linha\n```python\ndef buscar_paradas(self, codigo_linha):\n    \"\"\"Busca paradas de uma linha espec√≠fica\"\"\"\n    url = f\"{self.base_url}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\"\n    return self.session.get(url).json()\n```\n\n#### Posi√ß√µes dos Ve√≠culos\n```python\ndef buscar_posicoes(self, codigo_linha):\n    \"\"\"Busca posi√ß√µes em tempo real dos √¥nibus\"\"\"\n    url = f\"{self.base_url}/Posicao/Linha?codigoLinha={codigo_linha}\"\n    return self.session.get(url).json()\n```\n\n### 5. Visualiza√ß√£o com Folium\n\nO mapa interativo √© criado com diferentes marcadores:\n\n```python\n# Calcular centro do mapa (m√©dia das coordenadas)\nlat_centro = sum(p['py'] for p in paradas) / len(paradas)\nlon_centro = sum(p['px'] for p in paradas) / len(paradas)\n\n# Criar mapa base\nmapa = Map(\n    location=[lat_centro, lon_centro],\n    zoom_start=13,\n    tiles='OpenStreetMap'\n)\n```\n\n#### Marcadores de Paradas (Azul)\n```python\nMarker(\n    location=[parada['py'], parada['px']],\n    popup=f\"<b>Parada: {parada['np']}</b><br>Endere√ßo: {parada['ed']}\",\n    icon=Icon(color='blue', icon='stop', prefix='fa')\n).add_to(mapa)\n```\n\n#### Marcadores de √înibus (Vermelho)\n```python\nMarker(\n    location=[veiculo['py'], veiculo['px']],\n    popup=f\"<b>üöå √înibus - Prefixo: {veiculo['p']}</b>\",\n    icon=Icon(color='red', icon='bus', prefix='fa')\n).add_to(mapa)\n```\n\n### 6. Legenda Personalizada\n\nUma legenda HTML √© adicionada ao mapa:\n\n```python\nlegenda_html = f'''\n<div style=\"position: fixed; top: 10px; right: 10px; ...\">\n    <h4>Linha {nome_linha}</h4>\n    <p><i class=\"fa fa-stop\" style=\"color:blue\"></i> Paradas: {len(paradas)}</p>\n    <p><i class=\"fa fa-bus\" style=\"color:red\"></i> √înibus ativos: {len(veiculos)}</p>\n    <p>Hor√°rio: {hora_consulta}</p>\n</div>\n'''\n```\n\n## Resultados\n\nPara a linha **2780-10** (exemplo), obtivemos:\n\n- **XX paradas** mapeadas\n- **X √¥nibus** em circula√ß√£o no momento da consulta\n- Dados atualizados em tempo real\n\n### Mapa Interativo\n\n[Clique aqui para visualizar o mapa completo](mapa_linha_2503.html)\n\n**Legenda**:\n- üîµ **Pins azuis**: Paradas da linha\n- üî¥ **Pins vermelhos**: √înibus em circula√ß√£o\n\n## C√≥digo Completo\n\n::: {#08dfc9ee .cell execution_count=1}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Ver c√≥digo completo\"}\nimport requests\nimport folium\nfrom folium import Map, Marker, Icon\nfrom datetime import datetime\n\nTOKEN = \"seu_token_aqui\"\n\nclass MonitoramentoOnibus:\n    # [C√≥digo completo da classe]\n    pass\n\nif __name__ == \"__main__\":\n    monitor = MonitoramentoOnibus(TOKEN)\n    linhas = monitor.buscar_linhas(\"Paulista\")\n    mapa = monitor.criar_mapa(codigo_linha=2503, nome_linha=\"2780-10\")\n```\n:::\n\n\n## Desafios Encontrados\n\n1. **Autentica√ß√£o**: A API exige manter a sess√£o autenticada\n2. **Coordenadas**: Trabalhar com latitude e longitude (py, px)\n3. **Dados em tempo real**: Os dados mudam constantemente\n4. **Performance**: Minimizar chamadas √† API\n\n## Aprendizados\n\n1. **APIs com autentica√ß√£o**: Uso de sessions do requests\n2. **Mapas interativos**: Biblioteca Folium e suas customiza√ß√µes\n3. **Dados geoespaciais**: Trabalhar com coordenadas e visualiza√ß√µes\n4. **HTML/CSS**: Criar elementos personalizados no mapa\n\n## Poss√≠veis Melhorias\n\n- Auto-atualiza√ß√£o do mapa a cada X segundos\n- Filtros por regi√£o ou hor√°rio\n- Hist√≥rico de posi√ß√µes (tracking)\n- Previs√£o de chegada nas paradas\n- Interface web completa com Flask/Django\n\n---\n\n**Reposit√≥rio**: [Link para o c√≥digo no GitHub](https://github.com/seu-usuario/seu-repo)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}