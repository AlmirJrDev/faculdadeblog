{"title":"Atividade 02 - Monitoramento de √înibus em Tempo Real","markdown":{"yaml":{"title":"Atividade 02 - Monitoramento de √înibus em Tempo Real","author":"Seu Nome","date":"2024-11-23","categories":["python","api","mapas","geolocaliza√ß√£o"],"image":"thumbnail.jpg"},"headingText":"Objetivo","containsRefs":false,"markdown":"\n\n\nCriar um sistema de monitoramento em tempo real de √¥nibus da SPTrans utilizando a API Olho Vivo, com visualiza√ß√£o em mapa interativo.\n\n## Tecnologias Utilizadas\n\n- **Python 3.x**\n- **requests**: Para autentica√ß√£o e requisi√ß√µes √† API\n- **folium**: Para criar mapas interativos\n- **API SPTrans Olho Vivo**: Dados de transporte p√∫blico de S√£o Paulo\n\n## Arquitetura da Solu√ß√£o\n\n### 1. Autentica√ß√£o\n\nA API SPTrans exige autentica√ß√£o via POST com um token:\n\n```python\ndef autenticar(self):\n    \"\"\"Autentica na API da SPTrans\"\"\"\n    url = f\"{self.base_url}/Login/Autenticar?token={self.token}\"\n    response = self.session.post(url)\n    if response.text == \"true\":\n        print(\"‚úì Autentica√ß√£o realizada com sucesso!\")\n```\n\n**Importante**: A sess√£o autenticada deve ser mantida para todas as requisi√ß√µes subsequentes.\n\n### 2. Classe MonitoramentoOnibus\n\nImplementei uma classe para encapsular todas as funcionalidades:\n\n```python\nclass MonitoramentoOnibus:\n    def __init__(self, token):\n        self.token = token\n        self.session = requests.Session()\n        self.base_url = \"http://api.olhovivo.sptrans.com.br/v2.1\"\n        self.autenticar()\n```\n\n### 3. Busca de Linhas\n\nPermite buscar linhas por termo de pesquisa:\n\n```python\ndef buscar_linhas(self, termo_busca):\n    \"\"\"Busca linhas de √¥nibus por termo\"\"\"\n    url = f\"{self.base_url}/Linha/Buscar?termosBusca={termo_busca}\"\n    response = self.session.get(url)\n    return response.json()\n```\n\n### 4. Obten√ß√£o de Dados em Tempo Real\n\nDuas fun√ß√µes principais coletam dados:\n\n#### Paradas da Linha\n```python\ndef buscar_paradas(self, codigo_linha):\n    \"\"\"Busca paradas de uma linha espec√≠fica\"\"\"\n    url = f\"{self.base_url}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\"\n    return self.session.get(url).json()\n```\n\n#### Posi√ß√µes dos Ve√≠culos\n```python\ndef buscar_posicoes(self, codigo_linha):\n    \"\"\"Busca posi√ß√µes em tempo real dos √¥nibus\"\"\"\n    url = f\"{self.base_url}/Posicao/Linha?codigoLinha={codigo_linha}\"\n    return self.session.get(url).json()\n```\n\n### 5. Visualiza√ß√£o com Folium\n\nO mapa interativo √© criado com diferentes marcadores:\n\n```python\n# Calcular centro do mapa (m√©dia das coordenadas)\nlat_centro = sum(p['py'] for p in paradas) / len(paradas)\nlon_centro = sum(p['px'] for p in paradas) / len(paradas)\n\n# Criar mapa base\nmapa = Map(\n    location=[lat_centro, lon_centro],\n    zoom_start=13,\n    tiles='OpenStreetMap'\n)\n```\n\n#### Marcadores de Paradas (Azul)\n```python\nMarker(\n    location=[parada['py'], parada['px']],\n    popup=f\"<b>Parada: {parada['np']}</b><br>Endere√ßo: {parada['ed']}\",\n    icon=Icon(color='blue', icon='stop', prefix='fa')\n).add_to(mapa)\n```\n\n#### Marcadores de √înibus (Vermelho)\n```python\nMarker(\n    location=[veiculo['py'], veiculo['px']],\n    popup=f\"<b>üöå √înibus - Prefixo: {veiculo['p']}</b>\",\n    icon=Icon(color='red', icon='bus', prefix='fa')\n).add_to(mapa)\n```\n\n### 6. Legenda Personalizada\n\nUma legenda HTML √© adicionada ao mapa:\n\n```python\nlegenda_html = f'''\n<div style=\"position: fixed; top: 10px; right: 10px; ...\">\n    <h4>Linha {nome_linha}</h4>\n    <p><i class=\"fa fa-stop\" style=\"color:blue\"></i> Paradas: {len(paradas)}</p>\n    <p><i class=\"fa fa-bus\" style=\"color:red\"></i> √înibus ativos: {len(veiculos)}</p>\n    <p>Hor√°rio: {hora_consulta}</p>\n</div>\n'''\n```\n\n## Resultados\n\nPara a linha **2780-10** (exemplo), obtivemos:\n\n- **XX paradas** mapeadas\n- **X √¥nibus** em circula√ß√£o no momento da consulta\n- Dados atualizados em tempo real\n\n### Mapa Interativo\n\n[Clique aqui para visualizar o mapa completo](mapa_linha_2503.html)\n\n**Legenda**:\n- üîµ **Pins azuis**: Paradas da linha\n- üî¥ **Pins vermelhos**: √înibus em circula√ß√£o\n\n## C√≥digo Completo\n\n```{python}\n#| eval: false\n#| code-fold: true\n#| code-summary: \"Ver c√≥digo completo\"\n\nimport requests\nimport folium\nfrom folium import Map, Marker, Icon\nfrom datetime import datetime\n\nTOKEN = \"seu_token_aqui\"\n\nclass MonitoramentoOnibus:\n    # [C√≥digo completo da classe]\n    pass\n\nif __name__ == \"__main__\":\n    monitor = MonitoramentoOnibus(TOKEN)\n    linhas = monitor.buscar_linhas(\"Paulista\")\n    mapa = monitor.criar_mapa(codigo_linha=2503, nome_linha=\"2780-10\")\n```\n\n## Desafios Encontrados\n\n1. **Autentica√ß√£o**: A API exige manter a sess√£o autenticada\n2. **Coordenadas**: Trabalhar com latitude e longitude (py, px)\n3. **Dados em tempo real**: Os dados mudam constantemente\n4. **Performance**: Minimizar chamadas √† API\n\n## Aprendizados\n\n1. **APIs com autentica√ß√£o**: Uso de sessions do requests\n2. **Mapas interativos**: Biblioteca Folium e suas customiza√ß√µes\n3. **Dados geoespaciais**: Trabalhar com coordenadas e visualiza√ß√µes\n4. **HTML/CSS**: Criar elementos personalizados no mapa\n\n## Poss√≠veis Melhorias\n\n- Auto-atualiza√ß√£o do mapa a cada X segundos\n- Filtros por regi√£o ou hor√°rio\n- Hist√≥rico de posi√ß√µes (tracking)\n- Previs√£o de chegada nas paradas\n- Interface web completa com Flask/Django\n\n---\n\n**Reposit√≥rio**: [Link para o c√≥digo no GitHub](https://github.com/seu-usuario/seu-repo)","srcMarkdownNoYaml":"\n\n## Objetivo\n\nCriar um sistema de monitoramento em tempo real de √¥nibus da SPTrans utilizando a API Olho Vivo, com visualiza√ß√£o em mapa interativo.\n\n## Tecnologias Utilizadas\n\n- **Python 3.x**\n- **requests**: Para autentica√ß√£o e requisi√ß√µes √† API\n- **folium**: Para criar mapas interativos\n- **API SPTrans Olho Vivo**: Dados de transporte p√∫blico de S√£o Paulo\n\n## Arquitetura da Solu√ß√£o\n\n### 1. Autentica√ß√£o\n\nA API SPTrans exige autentica√ß√£o via POST com um token:\n\n```python\ndef autenticar(self):\n    \"\"\"Autentica na API da SPTrans\"\"\"\n    url = f\"{self.base_url}/Login/Autenticar?token={self.token}\"\n    response = self.session.post(url)\n    if response.text == \"true\":\n        print(\"‚úì Autentica√ß√£o realizada com sucesso!\")\n```\n\n**Importante**: A sess√£o autenticada deve ser mantida para todas as requisi√ß√µes subsequentes.\n\n### 2. Classe MonitoramentoOnibus\n\nImplementei uma classe para encapsular todas as funcionalidades:\n\n```python\nclass MonitoramentoOnibus:\n    def __init__(self, token):\n        self.token = token\n        self.session = requests.Session()\n        self.base_url = \"http://api.olhovivo.sptrans.com.br/v2.1\"\n        self.autenticar()\n```\n\n### 3. Busca de Linhas\n\nPermite buscar linhas por termo de pesquisa:\n\n```python\ndef buscar_linhas(self, termo_busca):\n    \"\"\"Busca linhas de √¥nibus por termo\"\"\"\n    url = f\"{self.base_url}/Linha/Buscar?termosBusca={termo_busca}\"\n    response = self.session.get(url)\n    return response.json()\n```\n\n### 4. Obten√ß√£o de Dados em Tempo Real\n\nDuas fun√ß√µes principais coletam dados:\n\n#### Paradas da Linha\n```python\ndef buscar_paradas(self, codigo_linha):\n    \"\"\"Busca paradas de uma linha espec√≠fica\"\"\"\n    url = f\"{self.base_url}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\"\n    return self.session.get(url).json()\n```\n\n#### Posi√ß√µes dos Ve√≠culos\n```python\ndef buscar_posicoes(self, codigo_linha):\n    \"\"\"Busca posi√ß√µes em tempo real dos √¥nibus\"\"\"\n    url = f\"{self.base_url}/Posicao/Linha?codigoLinha={codigo_linha}\"\n    return self.session.get(url).json()\n```\n\n### 5. Visualiza√ß√£o com Folium\n\nO mapa interativo √© criado com diferentes marcadores:\n\n```python\n# Calcular centro do mapa (m√©dia das coordenadas)\nlat_centro = sum(p['py'] for p in paradas) / len(paradas)\nlon_centro = sum(p['px'] for p in paradas) / len(paradas)\n\n# Criar mapa base\nmapa = Map(\n    location=[lat_centro, lon_centro],\n    zoom_start=13,\n    tiles='OpenStreetMap'\n)\n```\n\n#### Marcadores de Paradas (Azul)\n```python\nMarker(\n    location=[parada['py'], parada['px']],\n    popup=f\"<b>Parada: {parada['np']}</b><br>Endere√ßo: {parada['ed']}\",\n    icon=Icon(color='blue', icon='stop', prefix='fa')\n).add_to(mapa)\n```\n\n#### Marcadores de √înibus (Vermelho)\n```python\nMarker(\n    location=[veiculo['py'], veiculo['px']],\n    popup=f\"<b>üöå √înibus - Prefixo: {veiculo['p']}</b>\",\n    icon=Icon(color='red', icon='bus', prefix='fa')\n).add_to(mapa)\n```\n\n### 6. Legenda Personalizada\n\nUma legenda HTML √© adicionada ao mapa:\n\n```python\nlegenda_html = f'''\n<div style=\"position: fixed; top: 10px; right: 10px; ...\">\n    <h4>Linha {nome_linha}</h4>\n    <p><i class=\"fa fa-stop\" style=\"color:blue\"></i> Paradas: {len(paradas)}</p>\n    <p><i class=\"fa fa-bus\" style=\"color:red\"></i> √înibus ativos: {len(veiculos)}</p>\n    <p>Hor√°rio: {hora_consulta}</p>\n</div>\n'''\n```\n\n## Resultados\n\nPara a linha **2780-10** (exemplo), obtivemos:\n\n- **XX paradas** mapeadas\n- **X √¥nibus** em circula√ß√£o no momento da consulta\n- Dados atualizados em tempo real\n\n### Mapa Interativo\n\n[Clique aqui para visualizar o mapa completo](mapa_linha_2503.html)\n\n**Legenda**:\n- üîµ **Pins azuis**: Paradas da linha\n- üî¥ **Pins vermelhos**: √înibus em circula√ß√£o\n\n## C√≥digo Completo\n\n```{python}\n#| eval: false\n#| code-fold: true\n#| code-summary: \"Ver c√≥digo completo\"\n\nimport requests\nimport folium\nfrom folium import Map, Marker, Icon\nfrom datetime import datetime\n\nTOKEN = \"seu_token_aqui\"\n\nclass MonitoramentoOnibus:\n    # [C√≥digo completo da classe]\n    pass\n\nif __name__ == \"__main__\":\n    monitor = MonitoramentoOnibus(TOKEN)\n    linhas = monitor.buscar_linhas(\"Paulista\")\n    mapa = monitor.criar_mapa(codigo_linha=2503, nome_linha=\"2780-10\")\n```\n\n## Desafios Encontrados\n\n1. **Autentica√ß√£o**: A API exige manter a sess√£o autenticada\n2. **Coordenadas**: Trabalhar com latitude e longitude (py, px)\n3. **Dados em tempo real**: Os dados mudam constantemente\n4. **Performance**: Minimizar chamadas √† API\n\n## Aprendizados\n\n1. **APIs com autentica√ß√£o**: Uso de sessions do requests\n2. **Mapas interativos**: Biblioteca Folium e suas customiza√ß√µes\n3. **Dados geoespaciais**: Trabalhar com coordenadas e visualiza√ß√µes\n4. **HTML/CSS**: Criar elementos personalizados no mapa\n\n## Poss√≠veis Melhorias\n\n- Auto-atualiza√ß√£o do mapa a cada X segundos\n- Filtros por regi√£o ou hor√°rio\n- Hist√≥rico de posi√ß√µes (tracking)\n- Previs√£o de chegada nas paradas\n- Interface web completa com Flask/Django\n\n---\n\n**Reposit√≥rio**: [Link para o c√≥digo no GitHub](https://github.com/seu-usuario/seu-repo)"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.26","theme":"cosmo","title-block-banner":true,"title":"Atividade 02 - Monitoramento de √înibus em Tempo Real","author":"Seu Nome","date":"2024-11-23","categories":["python","api","mapas","geolocaliza√ß√£o"],"image":"thumbnail.jpg"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}